---
// Importa il layout e i componenti
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import Saldi from '../components/Saldi.astro';
import About from '../components/About.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
import OptimizedImage from '../components/OptimizedImage.astro';
import { getEntry, getCollection } from 'astro:content';

// Carica le impostazioni della homepage
const homepageSettings = await getEntry('homepage-settings', 'homepage-settings');
const saldiSettings = await getEntry('saldi-settings', 'saldi-settings');

// Carica i dati della galleria (con gestione errori per collezioni vuote)
let galleriaGiacche = [];
let galleriaAbiti = [];
let galleriaJeans = [];
let galleriaMaglieria = [];
let galleriaCamicie = [];
let galleriaPantaloni = [];
let galleriaFelpe = [];
let galleriaGiubbotti = [];

try {
  galleriaGiacche = await getCollection('galleria_giacche');
} catch (e) {
  console.warn('Collezione galleria_giacche non trovata o vuota');
}

try {
  galleriaAbiti = await getCollection('galleria_abiti_cerimonia');
} catch (e) {
  console.warn('Collezione galleria_abiti_cerimonia non trovata o vuota');
}

try {
  galleriaJeans = await getCollection('galleria_jeans');
} catch (e) {
  console.warn('Collezione galleria_jeans non trovata o vuota');
}

try {
  galleriaMaglieria = await getCollection('galleria_maglieria');
} catch (e) {
  console.warn('Collezione galleria_maglieria non trovata o vuota');
}

try {
  galleriaCamicie = await getCollection('galleria_camicie');
} catch (e) {
  console.warn('Collezione galleria_camicie non trovata o vuota');
}

try {
  galleriaPantaloni = await getCollection('galleria_pantaloni');
} catch (e) {
  console.warn('Collezione galleria_pantaloni non trovata o vuota');
}

try {
  galleriaFelpe = await getCollection('galleria_felpe');
} catch (e) {
  console.warn('Collezione galleria_felpe non trovata o vuota');
}

try {
  galleriaGiubbotti = await getCollection('galleria_giubbotti');
} catch (e) {
  console.warn('Collezione galleria_giubbotti non trovata o vuota');
}

// Filtra solo gli elementi attivi (con gestione array vuoti)
const giaccheAttive = (galleriaGiacche || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const abitiAttivi = (galleriaAbiti || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const jeansAttivi = (galleriaJeans || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const maglieriaAttiva = (galleriaMaglieria || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const giubbottiAttivi = (galleriaGiubbotti || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const camicieAttive = (galleriaCamicie || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const pantaloniAttivi = (galleriaPantaloni || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

const felpeAttive = (galleriaFelpe || [])
  .filter(item => item.data.attivo)
  .sort((a, b) => (a.data.ordine || 0) - (b.data.ordine || 0));

// Organizza le collezioni per la homepage (solo anteprima)
const collezioniAnteprima = [
  {
    id: 'abiti-cerimonia',
    nome: 'Abiti da Cerimonia',
    descrizione: 'Eleganza e raffinatezza per ogni occasione speciale',
    items: abitiAttivi.slice(0, 4), // Solo i primi 4
    colore: '#ddbb76',
    icona: 'üëî',
    categoria: 'Formale'
  },
  {
    id: 'sportswear',
    nome: 'Sportswear & Casual',
    descrizione: 'Comfort e stile per il tempo libero',
    items: [...giaccheAttive, ...giubbottiAttivi, ...felpeAttive].slice(0, 4),
    colore: '#3498db',
    icona: 'üëï',
    categoria: 'Casual'
  }
].filter(collezione => collezione.items.length > 0);

// Conta totale articoli per tutte le collezioni
const totalArticoli = [
  ...abitiAttivi,
  ...giaccheAttive,
  ...jeansAttivi,
  ...maglieriaAttiva,
  ...camicieAttive,
  ...pantaloniAttivi,
  ...felpeAttive,
  ...giubbottiAttivi
].length;

// Dati per le impostazioni
const showBanner = homepageSettings?.data?.mostraBannerSaldi ?? false;
const bannerText = homepageSettings?.data?.testoBanner ?? '';
const bannerLink = homepageSettings?.data?.linkBanner ?? '/saldi';
// Conversione sicura del booleano
const saldiAttivi = saldiSettings?.data?.saldiAttivi === true;

// Debug homepage
console.log('üîß Debug Homepage:');
console.log('- showBanner:', showBanner);
console.log('- saldiAttivi (raw):', saldiSettings?.data?.saldiAttivi);
console.log('- saldiAttivi (processed):', saldiAttivi);
// SEO data per homepage
const seoData = {
  title: "Kelua - Abbigliamento di Qualit√† a San Giovanni Rotondo dal 1975",
  description: "Kelua, negozio di abbigliamento a San Giovanni Rotondo dal 1975. Abiti da cerimonia, sportswear e moda uomo-donna di qualit√†. Due punti vendita specializzati. Eleganza e stile per ogni occasione.",
  keywords: [
    "abbigliamento San Giovanni Rotondo",
    "negozio abbigliamento Kelua", 
    "abiti cerimonia uomo donna",
    "sportswear qualit√†",
    "moda elegante San Giovanni Rotondo",
    "abbigliamento dal 1975",
    "vestiti cerimonia Puglia",
    "negozio moda San Giovanni Rotondo",
    "abiti eleganti",
    "sportswear casual"
  ],
  ogImage: "/logoKelua.png",
  jsonLD: {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "@id": "https://keluamoda.it/#webpage",
    "name": "Kelua - Abbigliamento di Qualit√†",
    "description": "Scopri Kelua: abbigliamento elegante e sportswear di qualit√† a San Giovanni Rotondo dal 1975. Due negozi specializzati per uomo e donna.",
    "url": "https://keluamoda.it",
    "mainEntity": {
      "@type": "ClothingStore", 
      "@id": "https://keluamoda.it/#business"
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://keluamoda.it"
        }
      ]
    }
  }
};

console.log('Homepage SEO configurata');
console.log('- Saldi attivi:', saldiAttivi);
console.log('- Banner sar√† mostrato:', showBanner && saldiAttivi);
console.log('- Abiti cerimonia trovati:', abitiAttivi.length);
console.log('- Sportswear trovati:', sportswearAttive.length);
---

<Layout 
  title={seoData.title}
  description={seoData.description}
  keywords={seoData.keywords}
  ogImage={seoData.ogImage}
  canonicalURL="https://keluamoda.it"
  jsonLD={seoData.jsonLD}
>
  <main class={showBanner && saldiAttivi ? 'has-saldi-banner' : ''}>
    <Navbar />
    
    <!-- Banner Saldi Dinamico -->
    {showBanner && saldiAttivi && (
      <div id="saldi-banner" class="saldi-banner">
        <div class="banner-content">
          <span class="banner-text">{bannerText}</span>
          <a href={bannerLink} class="banner-cta">Scopri i Saldi</a>
        </div>
        <button class="banner-close" aria-label="Chiudi banner">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    )}

    <Hero />
  
    <Saldi />
    
    <!-- Sezione Collezioni Anteprima -->
    <section id="collezioni" class="collezioni-preview-section">
      <div class="container">
        <!-- Intestazione Collezioni -->
        <div class="collezioni-header">
          <h2 class="collezioni-title">
            <span class="category-icon">‚ú®</span>
            Le Nostre Collezioni
          </h2>
          <p class="collezioni-description">
            Scopri un'anteprima delle nostre collezioni di abbigliamento di qualit√†. 
            Oltre {totalArticoli} articoli ti aspettano nella collezione completa.
          </p>
          <a href="/collezioni" class="collezioni-cta">
            Esplora Tutte le Collezioni
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="cta-icon">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </a>
        </div>

        <!-- Grid Collezioni -->
        <div class="collezioni-grid">
          {collezioniAnteprima.map((collezione) => (
            <div class="collezione-card" data-categoria={collezione.categoria}>
              <div class="collezione-header">
                <div class="collezione-badge" style={`background-color: ${collezione.colore}`}>
                  <span class="collezione-icon">{collezione.icona}</span>
                  <span class="collezione-categoria">{collezione.categoria}</span>
                </div>
                <h3 class="collezione-title">{collezione.nome}</h3>
                <p class="collezione-description">{collezione.descrizione}</p>
              </div>
              
              <div class="collezione-gallery">
                {collezione.items.map((item, index) => (
                  <div class="gallery-item" data-index={index}>
                    <OptimizedImage
                      src={item.data.immagine || '/background.png'}
                      alt={item.data.titolo}
                      width={200}
                      height={250}
                      loading="lazy"
                      class="gallery-image"
                      sizes="(min-width: 1024px) 200px, (min-width: 768px) 150px, 120px"
                      responsive={true}
                    />
                    <div class="gallery-overlay">
                      <span class="item-name">{item.data.titolo}</span>
                    </div>
                  </div>
                ))}
              </div>
              
              <div class="collezione-footer">
                <div class="collezione-stats">
                  <span class="stat-number">{collezione.items.length}+</span>
                  <span class="stat-label">Articoli disponibili</span>
                </div>
                <a href={`/collezioni/${collezione.id}`} class="collezione-btn">
                  Esplora Collezione
                  <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </a>
              </div>
            </div>
          ))}
        </div>

        <!-- Call to Action Finale -->
        <div class="collezioni-final-cta">
          <div class="final-cta-content">
            <h3 class="final-cta-title">Vuoi vedere di pi√π?</h3>
            <p class="final-cta-description">
              Esplora tutte le nostre collezioni complete con centinaia di articoli selezionati per te.
            </p>
            <a href="/collezioni" class="final-cta-button">
              Vai alle Collezioni Complete
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>
    
    <About />
    <Contact />
  </main>
  <Footer />
</Layout>

<script>
  // Gestione sincronizzazione banner saldi con navbar
  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('saldi-banner');
    const closeBtn = banner?.querySelector('.banner-close');
    const navbar = document.querySelector('.kelua-hero-tabs-container');
    
    if (closeBtn && banner) {
      closeBtn.addEventListener('click', () => {
        banner.style.animation = 'slideUp 0.3s ease-out forwards';
        setTimeout(() => {
          banner.style.display = 'none';
          // Rimuovi compensazione del banner dalle sezioni
          const sections = document.querySelectorAll('section');
          sections.forEach(section => {
            section.style.scrollMarginTop = '100px'; // Solo navbar
          });
        }, 300);
      });
    }

    // Sincronizzazione banner con navbar durante lo scroll
    if (banner && navbar) {
      const updateBannerPosition = () => {
        const heroSection = document.querySelector('.kelua-hero-tabs');
        const tabContainer = document.querySelector('.kelua-hero-tabs-container');
        
        if (!heroSection || !tabContainer) return;
        
        // Calcola quando la navbar diventa sticky
        const heroHeight = heroSection.offsetHeight;
        const tabHeight = 40;
        const stickyPoint = heroHeight - tabHeight;
        const scrollTop = window.pageYOffset;
        
        if (scrollTop >= stickyPoint) {
          // Navbar √® sticky in alto, banner deve essere sotto la navbar sticky
          banner.style.top = `${tabHeight}px`;
        } else {
          // Navbar √® ancora nel hero, banner rimane sotto l'hero
          const remainingHeroHeight = heroHeight - scrollTop;
          banner.style.top = `${remainingHeroHeight}px`;
        }
      };

      // Aggiorna posizione banner durante lo scroll
      let scrollTimeout;
      window.addEventListener('scroll', () => {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(updateBannerPosition, 10);
      });

      // Aggiorna al resize della finestra
      window.addEventListener('resize', updateBannerPosition);
      
      // Inizializzazione immediata
      updateBannerPosition();
    }
  });
</script>

<style>
  main {
    overflow-x: hidden;
  }
  
  /* Scroll behavior migliorato */
  html {
    scroll-behavior: smooth;
  }
  
  /* Rimuovi margini di default */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  
  /* Migliora la leggibilit√† del testo */
  body {
    line-height: 1.6;
    color: #333;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  /* Banner Saldi Dinamico */
  .saldi-banner {
    position: fixed;
    top: 0; /* Gestito da JavaScript */
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    padding: 12px 20px;
    z-index: 9998;
    box-shadow: 0 4px 20px rgba(231, 76, 60, 0.3);
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    animation: slideDown 0.5s ease-out;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); /* Transizione fluida ottimizzata */
    transform: translateZ(0); /* Forza layer di compositing per performance */
    will-change: top; /* Ottimizza animazioni position */
  }

  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(0);
      opacity: 1;
    }
    to {
      transform: translateY(-100%);
      opacity: 0;
    }
  }

  .banner-content {
    display: flex;
    align-items: center;
    gap: 20px;
    flex: 1;
    justify-content: center;
  }

  .banner-text {
    font-size: 1rem;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  .banner-cta {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
  }

  .banner-cta:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }

  .banner-close {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    opacity: 0.8;
  }

  .banner-close:hover {
    opacity: 1;
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }

  /* Compensazione per banner + navbar */
  .saldi-banner + * {
    margin-top: 60px; /* Altezza del banner */
  }
  
  /* Compensazione per navbar fissa */
  section {
    scroll-margin-top: 140px; /* navbar + banner */
  }

  /* Riduzione padding Hero quando presente banner saldi */
  main.has-saldi-banner section#home .hero-content {
    padding-top: 60px; /* Ridotto da 120px per compensare il banner */
  }

  /* Responsive per il banner */
  @media (max-width: 768px) {
    .saldi-banner {
      padding: 10px 15px;
      font-size: 0.9rem;
      --navbar-height: 70px; /* Altezza navbar mobile */
    }
    
    .banner-content {
      gap: 15px;
    }
    
    .banner-text {
      font-size: 0.9rem;
    }
    
    .banner-cta {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    
    /* Compensazione mobile per hero */
    main.has-saldi-banner section#home .hero-content {
      padding-top: 40px;
    }
  }

  @media (max-width: 480px) {
    .saldi-banner {
      --navbar-height: 65px; /* Altezza navbar mobile piccolo */
    }
  }
  
  /* Accessibility: migliora il focus */
  button:focus,
  a:focus,
  input:focus,
  textarea:focus,
  select:focus {
    outline: 2px solid #ddbb76;
    outline-offset: 2px;
  }
  
  /* Performance: migliora le animazioni */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
    
    html {
      scroll-behavior: auto;
    }
  }

  /* Container base */
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    text-align: center; /* Centra tutto il contenuto */
  }

  /* Collezioni Preview Section */
  .collezioni-preview-section {
    padding: 60px 0;
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    position: relative;
    overflow: hidden;
  }

  .collezioni-preview-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ddbb76' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    pointer-events: none;
  }

  .gallery-main-header {
    text-align: center;
    margin-bottom: 5rem;
    position: relative;
    z-index: 2;
  }

  .main-title {
    font-size: 4rem;
    font-weight: 300;
    background: linear-gradient(135deg, #ddbb76, #b8a866);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
    line-height: 1.1;
  }

  .title-icon {
    display: inline-block;
    margin-right: 1rem;
    font-size: 3.5rem;
    vertical-align: middle;
    filter: drop-shadow(0 4px 8px rgba(221, 187, 118, 0.3));
  }

  .main-description {
    font-size: 1.3rem;
    color: #475569;
    max-width: 800px;
    margin: 0 auto;
    line-height: 1.8;
    font-weight: 400;
  }

  .gallery-sections {
    position: relative;
    z-index: 2;
  }

  /* Stili specifici per le sezioni - Colori Kelua */
  .ceremony-section {
    background: linear-gradient(135deg, #fef9f0, #f7e6c4);
  }

  .sportswear-section {
    background: linear-gradient(135deg, #f9f6f0, #f1e8d4);
  }

  .jeans-section {
    background: linear-gradient(135deg, #f8f6f2, #ede4d3);
  }

  .shirts-section {
    background: linear-gradient(135deg, #faf8f5, #f0e7d6);
  }

  .formal-shirts-section {
    background: linear-gradient(135deg, #fdfcfa, #f2e9d8);
  }

  .pants-section {
    background: linear-gradient(135deg, #fcfaf7, #f3eadb);
  }

  .sweatshirts-section {
    background: linear-gradient(135deg, #fefdfb, #f4ebdc);
  }

  .galleria-header {
    text-align: center;
    margin-bottom: 80px;
  }

  .galleria-title {
    font-size: 3.5rem;
    font-weight: 300;
    color: #ddbb76;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  .title-icon {
    font-size: 3rem;
  }

  .galleria-description {
    font-size: 1.2rem;
    color: #ccc;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .galleria-category {
    margin-bottom: 100px;
    padding: 60px 0;
    border-radius: 20px;
    background: rgba(45, 45, 45, 0.8);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(221, 187, 118, 0.3);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
  }

  .category-title {
    font-size: 2.5rem;
    font-weight: 300;
    color: #ddbb76;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
  }

  .category-icon {
    font-size: 2.2rem;
  }

  .category-description {
    font-size: 1.1rem;
    color: #ccc;
    text-align: center;
    max-width: 500px;
    margin: 0 auto 60px;
    line-height: 1.6;
  }

  .carousel-container {
    position: relative;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 80px;
  }

  .carousel-wrapper {
    overflow: hidden;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(221, 187, 118, 0.3);
    padding: 40px 30px;
    box-shadow: 0 10px 30px rgba(221, 187, 118, 0.1);
  }

  .carousel-track {
    display: flex;
    transition: transform 0.5s ease;
  }

  .carousel-slide {
    min-width: 33.333%;
    flex: 0 0 33.333%;
    padding: 0 15px;
  }

  .image-card {
    position: relative;
    height: 500px !important;
    min-height: 500px !important;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    transition: transform 0.3s ease;
  }

  .image-card:hover {
    transform: translateY(-10px) scale(1.02);
  }

  .image-card img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    transition: transform 0.3s ease;
    display: block !important;
  }

  /* Stili per componenti ottimizzati */
  .image-card picture {
    width: 100% !important;
    height: 100% !important;
    display: block !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
  }

  .image-card picture img,
  .image-card .optimized-image {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    transition: transform 0.3s ease;
    display: block !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
  }

  .image-card:hover img,
  .image-card:hover picture img,
  .image-card:hover .optimized-image {
    transform: scale(1.05);
  }

  .image-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
    color: white;
    padding: 30px 20px 20px;
    transform: translateY(100%);
    transition: transform 0.3s ease;
  }

  .image-card:hover .image-overlay {
    transform: translateY(0);
  }

  .image-overlay h4 {
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 8px;
    color: #ddbb76;
  }

  .image-overlay p {
    font-size: 0.9rem;
    color: #ccc;
    margin-bottom: 12px;
    line-height: 1.4;
  }

  .image-category {
    background: rgba(221, 187, 118, 0.2);
    color: #ddbb76;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: 600;
    display: inline-block;
    border: 1px solid rgba(221, 187, 118, 0.3);
  }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: #ddbb76;
    border: 2px solid rgba(221, 187, 118, 0.3);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    z-index: 10;
  }

  .carousel-btn:hover {
    background: linear-gradient(135deg, #ddbb76, #c9a961);
    color: #1a1a1a;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 8px 25px rgba(221, 187, 118, 0.4);
  }

  .carousel-btn.carousel-prev {
    left: 10px;
  }

  .carousel-btn.carousel-next {
    right: 10px;
  }

  .carousel-indicators {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 40px;
    padding: 20px 0;
  }

  .indicator {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 2px solid rgba(221, 187, 118, 0.3);
    background: rgba(0, 0, 0, 0.8);
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .indicator.active {
    background: linear-gradient(135deg, #ddbb76, #c9a961);
    border-color: #ddbb76;
    transform: scale(1.4);
    box-shadow: 
      0 6px 20px rgba(221, 187, 118, 0.5),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
  }

  .indicator:hover {
    background: linear-gradient(135deg, #ddbb76, #c9a961);
    border-color: #ddbb76;
    transform: scale(1.2);
    box-shadow: 
      0 5px 15px rgba(221, 187, 118, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  /* Responsive Design Galleria */
  @media (max-width: 1024px) {
    .carousel-slide {
      min-width: 50%;
      flex: 0 0 50%;
    }
    
    .image-card {
      height: 450px !important;
      min-height: 450px !important;
    }

    .image-card img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      display: block !important;
    }
    
    .carousel-container {
      padding: 0 60px;
    }
    
    .carousel-btn {
      width: 50px;
      height: 50px;
      font-size: 20px;
    }
  }

  @media (max-width: 768px) {
    .carousel-slide {
      min-width: 100%;
      flex: 0 0 100%;
      padding: 0 5px;
    }
    
    .galleria-section {
      padding: 80px 0;
    }
    
    .galleria-title {
      font-size: 2.5rem;
    }
    
    .category-title {
      font-size: 2rem;
    }
    
    .image-card {
      height: 420px !important;
      min-height: 420px !important;
    }

    .image-card img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      display: block !important;
    }
    
    .carousel-container {
      padding: 0 50px;
    }
    
    .carousel-btn {
      width: 45px;
      height: 45px;
      font-size: 18px;
    }
  }

  @media (max-width: 480px) {
    .galleria-title {
      font-size: 2rem;
      flex-direction: column;
      gap: 10px;
    }
    
    .category-title {
      font-size: 1.8rem;
      flex-direction: column;
      gap: 8px;
    }
    
    .image-card {
      height: 380px !important;
      min-height: 380px !important;
    }

    .image-card img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      display: block !important;
    }
    
    .carousel-container {
      padding: 0 40px;
    }
    
    .carousel-btn {
      width: 40px;
      height: 40px;
      font-size: 16px;
    }
  }
</style>

<script>
  // Galleria Carousel Management
  class GalleryCarousel {
    constructor(container, category) {
      this.container = container;
      this.category = category;
      this.currentIndex = 0;
      this.items = [];
      this.initializeCarousel();
    }

    initializeCarousel() {
      // Inizializza controlli
      this.track = this.container.querySelector('.carousel-track');
      this.slides = this.container.querySelectorAll('.carousel-slide');
      this.prevBtn = this.container.querySelector('.carousel-prev');
      this.nextBtn = this.container.querySelector('.carousel-next');
      this.indicators = this.container.querySelectorAll('.indicator');
      
      // Calcola slide per vista
      this.slidesPerView = this.getSlidesPerView();
      this.maxIndex = Math.max(0, this.slides.length - this.slidesPerView);
      
      // Event listeners
      this.prevBtn?.addEventListener('click', () => this.prevSlide());
      this.nextBtn?.addEventListener('click', () => this.nextSlide());
      
      this.indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => this.goToSlide(index));
      });
      
      // Resize listener
      window.addEventListener('resize', () => this.handleResize());
      
      // Auto-play
      this.startAutoPlay();
      
      // Inizializza vista
      this.updateSlidePosition();
      this.updateIndicators();
    }

    getSlidesPerView() {
      const width = window.innerWidth;
      if (width <= 768) return 1;
      if (width <= 1024) return 2;
      return 3;
    }

    handleResize() {
      this.slidesPerView = this.getSlidesPerView();
      this.maxIndex = Math.max(0, this.slides.length - this.slidesPerView);
      this.currentIndex = Math.min(this.currentIndex, this.maxIndex);
      this.updateSlidePosition();
    }

    nextSlide() {
      if (this.currentIndex < this.maxIndex) {
        this.currentIndex++;
      } else {
        this.currentIndex = 0;
      }
      this.updateSlidePosition();
      this.updateIndicators();
      this.restartAutoPlay();
    }

    prevSlide() {
      if (this.currentIndex > 0) {
        this.currentIndex--;
      } else {
        this.currentIndex = this.maxIndex;
      }
      this.updateSlidePosition();
      this.updateIndicators();
      this.restartAutoPlay();
    }

    goToSlide(index) {
      this.currentIndex = Math.min(index, this.maxIndex);
      this.updateSlidePosition();
      this.updateIndicators();
      this.restartAutoPlay();
    }

    updateSlidePosition() {
      const percentage = (this.currentIndex / this.slidesPerView) * 100;
      this.track.style.transform = `translateX(-${percentage}%)`;
    }

    updateIndicators() {
      this.indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === this.currentIndex);
      });
    }

    startAutoPlay() {
      this.autoPlayInterval = setInterval(() => {
        this.nextSlide();
      }, 5000);
    }

    stopAutoPlay() {
      clearInterval(this.autoPlayInterval);
    }

    restartAutoPlay() {
      this.stopAutoPlay();
      this.startAutoPlay();
    }
  }

  // Inizializza caroselli
  document.addEventListener('DOMContentLoaded', () => {
    // Trova tutti i contenitori carousel
    const carouselContainers = document.querySelectorAll('.carousel-container');
    
    carouselContainers.forEach((container, index) => {
      const track = container.querySelector('.carousel-track');
      if (track) {
        const carouselId = track.id;
        new GalleryCarousel(container, carouselId);
      }
    });
  });

  // Ferma auto-play quando l'utente interagisce
  document.addEventListener('DOMContentLoaded', () => {
    const carouselContainers = document.querySelectorAll('.carousel-container');
    
    carouselContainers.forEach(container => {
      container.addEventListener('mouseenter', () => {
        const carousel = container.closest('.galleria-category');
        if (carousel) carousel.classList.add('paused');
      });
      
      container.addEventListener('mouseleave', () => {
        const carousel = container.closest('.galleria-category');
        if (carousel) carousel.classList.remove('paused');
      });
    });
  });

  // Gestisce visibilit√† (pause quando non visibile)
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -100px 0px'
  };

  const galleryObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  document.addEventListener('DOMContentLoaded', () => {
    // Intersection Observer per animazioni
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    // Osserva tutti gli elementi delle collezioni
    document.querySelectorAll('.collezione-card, .preview-item').forEach((item) => {
      item.style.opacity = '0';
      item.style.transform = 'translateY(30px)';
      item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(item);
    });
  });
</script>

<style>
  /* Collezioni Header */
  .collezioni-header {
    text-align: center;
    margin-bottom: 80px;
    position: relative;
    z-index: 2;
  }

  .collezioni-title {
    font-size: clamp(3rem, 5vw, 4.5rem);
    font-weight: 300;
    background: linear-gradient(135deg, #ddbb76, #b8a866);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 1.5rem;
    letter-spacing: -0.02em;
    line-height: 1.1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
  }

  .collezioni-title .category-icon {
    font-size: 3.5rem;
    filter: drop-shadow(0 4px 8px rgba(221, 187, 118, 0.3));
  }

  .collezioni-description {
    font-size: 1.3rem;
    color: rgba(255, 255, 255, 0.7);
    max-width: 800px;
    margin: 0 auto 2rem;
    line-height: 1.8;
    font-weight: 400;
  }

  .collezioni-cta {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 15px 30px;
    background: linear-gradient(135deg, #ddbb76, #b8a866);
    color: #1a1a1a;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px rgba(221, 187, 118, 0.3);
  }

  .collezioni-cta:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(221, 187, 118, 0.5);
    background: linear-gradient(135deg, #b8a866, #ddbb76);
  }

  .cta-icon {
    transition: transform 0.3s ease;
  }

  .collezioni-cta:hover .cta-icon {
    transform: translateX(5px);
  }

  /* Grid Collezioni - Design Professionale */
  .collezioni-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    margin-bottom: 60px;
    position: relative;
    z-index: 2;
  }

  .collezione-card {
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid rgba(221, 187, 118, 0.2);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s ease;
    backdrop-filter: blur(20px);
    position: relative;
  }

  .collezione-card:hover {
    transform: translateY(-8px);
    border-color: rgba(221, 187, 118, 0.6);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
  }

  /* Header della collezione */
  .collezione-header {
    padding: 24px;
    text-align: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .collezione-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border-radius: 20px;
    color: white;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 16px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .collezione-icon {
    font-size: 1.2rem;
  }

  .collezione-categoria {
    font-size: 0.8rem;
  }

  .collezione-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: white;
    margin: 0 0 12px 0;
    font-family: 'Playfair Display', serif;
  }

  .collezione-description {
    font-size: 0.95rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    margin: 0;
  }

  /* Galleria prodotti */
  .collezione-gallery {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2px;
    aspect-ratio: 1;
  }

  .gallery-item {
    position: relative;
    overflow: hidden;
    aspect-ratio: 1;
  }

  .gallery-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .gallery-item:hover .gallery-image {
    transform: scale(1.05);
  }

  .gallery-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
    color: white;
    padding: 12px 8px 8px;
    transform: translateY(100%);
    transition: transform 0.3s ease;
  }

  .gallery-item:hover .gallery-overlay {
    transform: translateY(0);
  }

  .item-name {
    font-size: 0.8rem;
    font-weight: 500;
    display: block;
    text-align: center;
  }

  /* Footer della collezione */
  .collezione-footer {
    padding: 20px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0, 0, 0, 0.3);
  }

  .collezione-stats {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  .stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: #ddbb76;
    line-height: 1;
  }

  .stat-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .collezione-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: linear-gradient(135deg, #ddbb76, #c9a96e);
    color: #000;
    text-decoration: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .collezione-btn:hover {
    background: linear-gradient(135deg, #e6c88a, #ddbb76);
    transform: translateX(4px);
    box-shadow: 0 4px 12px rgba(221, 187, 118, 0.4);
  }

  .collezione-btn svg {
    transition: transform 0.3s ease;
  }

  .collezione-btn:hover svg {
    transform: translateX(2px);
  }

  /* Collezione link (deprecato - rimosso) */
    margin: 0;
  }

  /* CTA Finale */
  .collezioni-final-cta {
    text-align: center;
    padding: 60px 40px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(221, 187, 118, 0.3);
    border-radius: 25px;
    position: relative;
    z-index: 2;
  }

  .final-cta-content {
    max-width: 600px;
    margin: 0 auto;
  }

  .final-cta-title {
    font-size: 2.2rem;
    font-weight: 300;
    color: #ddbb76;
    margin-bottom: 1rem;
    text-shadow: 0 0 15px rgba(221, 187, 118, 0.3);
  }

  .final-cta-description {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .final-cta-button {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    padding: 18px 40px;
    background: linear-gradient(135deg, #ddbb76, #b8a866);
    color: #1a1a1a;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 700;
    font-size: 1.2rem;
    transition: all 0.3s ease;
    box-shadow: 0 10px 30px rgba(221, 187, 118, 0.4);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .final-cta-button:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 15px 40px rgba(221, 187, 118, 0.6);
    background: linear-gradient(135deg, #b8a866, #ddbb76);
  }

  /* Responsive Design - Collezioni */
  @media (max-width: 768px) {
    .collezioni-preview-section {
      padding: 80px 0;
    }

    .collezioni-header {
      margin-bottom: 50px;
    }

    .collezioni-grid {
      grid-template-columns: 1fr;
      gap: 24px;
      margin-bottom: 50px;
    }

    .collezione-header {
      padding: 20px;
    }

    .collezione-title {
      font-size: 1.3rem;
    }

    .collezione-gallery {
      grid-template-columns: repeat(2, 1fr);
    }

    .collezione-footer {
      padding: 16px 20px;
      flex-direction: column;
      gap: 16px;
      text-align: center;
    }

    .collezione-stats {
      align-items: center;
    }

    .collezione-btn {
      padding: 12px 24px;
    }

    .collezione-preview-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .final-cta-title {
      font-size: 1.8rem;
    }

    .collezioni-final-cta {
      padding: 40px 25px;
    }
  }

  /* Tablet Design */
  @media (min-width: 769px) and (max-width: 1024px) {
    .collezioni-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }

    .collezione-card {
      padding: 20px;
    }

    .collezione-title {
      font-size: 1.4rem;
    }

    .collezioni-final-cta {
      padding: 50px 30px;
    }
  }

  /* Small Desktop */
  @media (min-width: 1025px) and (max-width: 1280px) {
    .collezioni-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 28px;
    }
  }

  @media (max-width: 480px) {
    .collezioni-grid {
      grid-template-columns: 1fr;
      gap: 25px;
    }

    .collezione-card {
      padding: 20px;
    }

    .collezione-preview-grid {
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .preview-item {
      aspect-ratio: 3/4;
    }

    .final-cta-button {
      padding: 15px 30px;
      font-size: 1rem;
    }
  }
</style>
